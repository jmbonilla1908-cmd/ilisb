{% extends "admin/layout.html" %}

{% block admin_content %}
<div class="container-fluid">
    <!-- Breadcrumb y navegación -->
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="{{ url_for('admin.dashboard') }}">
                            Dashboard
                        </a>
                    </li>
                    <li class="breadcrumb-item active">Gestión de Cursos</li>
                </ol>
            </nav>
        </div>
    </div>

    <!-- Header con título y botones -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="mb-0">Gestión de Cursos</h1>
                <div class="btn-group">
                    <a href="{{ url_for('admin.dashboard') }}" class="btn btn-outline-secondary">
                        Volver al Dashboard
                    </a>
                    <a href="{{ url_for('admin.nuevo_curso') }}" class="btn btn-primary">
                        Nuevo Curso
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Estadísticas rápidas -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <h5 class="card-title">Total Cursos</h5>
                    <h2 class="mb-0">{{ cursos|length }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <h5 class="card-title">Activos</h5>
                    <h2 class="mb-0">{{ cursos|length }}</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla de cursos -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Lista de Cursos</h5>
                </div>
                <div class="card-body">
                    {% if cursos %}
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th scope="col">ID</th>
                                        <th scope="col">Nombre del Curso</th>
                                        <th scope="col">Duración (hrs)</th>
                                        <th scope="col">Slug</th>
                                        <th scope="col">Estado</th>
                                        <th scope="col">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for curso in cursos %}
                                    <tr>
                                        <th scope="row">{{ curso.id }}</th>
                                        <td>
                                            <strong>{{ curso.nombre }}</strong>
                                            {% if curso.descripcion %}
                                                <br><small class="text-muted">{{ curso.descripcion[:100] }}...</small>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <span class="badge bg-secondary">{{ curso.duracion }} hrs</span>
                                        </td>
                                        <td>
                                            <code>{{ curso.slug }}</code>
                                        </td>
                                        <td>
                                            <span class="badge bg-success">Activo</span>
                                        </td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <a href="{{ url_for('cursos.detalle_curso', slug=curso.slug) }}" 
                                                   class="btn btn-outline-info" 
                                                   title="Ver curso público"
                                                   target="_blank">
                                                    Ver
                                                </a>
                                                <a href="{{ url_for('admin.editar_curso', slug=curso.slug) }}" 
                                                   class="btn btn-outline-warning" 
                                                   title="Editar curso">
                                                    Editar
                                                </a>
                                                <a href="#" 
                                                   class="btn btn-outline-danger" 
                                                   onclick="confirmarEliminacion('{{ curso.nombre|replace("'", "\\'") }}', {{ curso.id }})"
                                                   title="Eliminar curso">
                                                    Eliminar
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-info text-center">
                            <h4>No hay cursos registrados</h4>
                            <p>Parece que aún no hay cursos en el sistema.</p>
                            <a href="#" class="btn btn-primary" onclick="alert('Función próximamente disponible')">
                                Crear primer curso
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para confirmar eliminación -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Confirmar Eliminación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>¿Estás seguro de que deseas eliminar el curso?</p>
                <strong id="cursoNombre"></strong>
                <p class="text-danger mt-2">
                    <small>Esta acción no se puede deshacer.</small>
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    Cancelar
                </button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                    Eliminar Curso
                </button>
            </div>
        </div>
    </div>
</div>

<script>
function confirmarEliminacion(nombreCurso, cursoId) {
    document.getElementById('cursoNombre').textContent = nombreCurso;
    document.getElementById('confirmDeleteBtn').onclick = function() {
        alert('Función de eliminación próximamente disponible para curso ID: ' + cursoId);
        // Aquí iría la lógica de eliminación
        var modal = bootstrap.Modal.getInstance(document.getElementById('confirmDeleteModal'));
        modal.hide();
    };
    
    var modal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
    modal.show();
}
</script>

{% endblock %}