{% extends "webapps/base_aplicativo.html" %}

{% block title %}{{ aplicativo.nombre }}{% endblock %}

{% block aplicativo_content %}
<div class="row">
    <!-- Columna de Parámetros -->
    <div class="col-lg-5">
        <div class="card">
            <div class="card-header"><h5 class="mb-0">Parámetros de Cálculo</h5></div>
            <div class="card-body">
                <form action="" method="GET">
                    <h6>Motor Eléctrico y Ambiente</h6>
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label for="alim" class="form-label">Alimentación</label>
                            <select class="form-select" id="alim" name="alim">
                                <option value="2" {% if request.args.get('alim') == '2' %}selected{% endif %}>Monofásica</option>
                                <option value="1.73" {% if request.args.get('alim', '1.73') == '1.73' %}selected{% endif %}>Trifásica</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="volt" class="form-label">Voltaje (V)</label>
                            <select class="form-select" id="volt" name="volt">
                                <option value="110" {% if request.args.get('volt') == '110' %}selected{% endif %}>110</option>
                                <option value="220" {% if request.args.get('volt') == '220' %}selected{% endif %}>220</option>
                                <option value="380" {% if request.args.get('volt') == '380' %}selected{% endif %}>380</option>
                                <option value="440" {% if request.args.get('volt', '440') == '440' %}selected{% endif %}>440</option>
                                <option value="460" {% if request.args.get('volt') == '460' %}selected{% endif %}>460</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="amper" class="form-label">Amperaje (A)</label>
                            <input type="text" inputmode="decimal" class="form-control" id="amper" name="amper" value="{{ request.args.get('amper', '125') }}">
                        </div>
                        <div class="col-md-6">
                            <label for="f_potencia" class="form-label">Factor de Potencia</label>
                            <input type="text" inputmode="decimal" class="form-control" id="f_potencia" name="f_potencia" value="{{ request.args.get('f_potencia', '0.89') }}">
                        </div>
                        <div class="col-md-6">
                            <label for="temperatura" class="form-label">Temperatura (°C)</label>
                            <input type="text" inputmode="decimal" class="form-control" id="temperatura" name="temperatura" value="{{ request.args.get('temperatura', '40') }}">
                        </div>
                    </div>

                    <h6>Arrancador Eléctrico</h6>
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label for="t_arranque" class="form-label">Tipo de Arranque</label>
                            <select class="form-select" id="t_arranque" name="t_arranque">
                                <option value="1.73" {% if request.args.get('t_arranque') == '1.73' %}selected{% endif %}>Estrella-Triángulo</option>
                                <option value="1" {% if request.args.get('t_arranque', '1') == '1' %}selected{% endif %}>Directo</option>
                            </select>
                        </div>
                    </div>

                    <h6>Datos del Cable</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label for="long_cable" class="form-label">Longitud (m)</label>
                            <input type="text" inputmode="decimal" class="form-control" id="long_cable" name="long_cable" value="{{ request.args.get('long_cable', '282') }}">
                        </div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" name="calcular" value="1" class="btn btn-primary">Calcular</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Columna de Resultados -->
    <div class="col-lg-7">
        {% if resultados %}
        <div class="card">
            <div class="card-header"><h5 class="mb-0">Cálculo de Caída de Voltaje (%)</h5></div>
            <div class="card-body">
                <p>Para una distancia de <strong>{{ request.args.get('long_cable') }} m</strong> y un amperaje corregido de <strong>{{ "%.2f"|format(resultados.amperaje_corregido) }} A</strong>:</p>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>AWG</th>
                                <th>mm²</th>
                                <th>Amp. Cable</th>
                                <th>Caída de Voltaje</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for cable in resultados.tabla %}
                            <tr class="{{ cable.clase_css }}">
                                <td>{{ cable.awg }}</td>
                                <td>{{ cable.mm2 }}</td>
                                <td>{{ cable.ampacidad }} A</td>
                                <td><strong>{{ "%.2f"|format(cable.caida_voltaje) }} %</strong></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="mt-3">
                    <span class="badge bg-success">Verde</span>: Opción recomendada (Caída de voltaje &lt; 3%).<br>
                    <span class="badge bg-warning text-dark">Amarillo</span>: Opción aceptable (3% &lt; Caída &lt; 5%).<br>
                    <span class="badge bg-danger">Rojo</span>: No recomendado (Caída &gt; 5% o amperaje excedido).
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block instrucciones_titulo %}{{ aplicativo.nombre }}{% endblock %}
{% block instrucciones_content %}
<p>Optimice la eficiencia energética y la seguridad de su sistema de bombeo con nuestra aplicación de cálculo de cable sumergible, garantizando el cumplimiento de los estándares eléctricos. Dimensionar adecuadamente el cable que alimenta su bomba es esencial para evitar pérdidas de energía, caídas de tensión y riesgos eléctricos.</p>

<p>Los datos de entrada incluyen el amperaje máximo o nominal del motor, el voltaje nominal, el factor de potencia y la temperatura ambiente. Además, debe proporcionar la longitud del cable entre el arrancador eléctrico y el tipo de arrancador utilizado, ya sea Estrella-Triángulo o arranque directo.</p>

<p>Como resultado, recibirá una tabla detallada con todos los calibres de cable disponibles en el mercado, junto con el porcentaje de caída de voltaje correspondiente. Los calibres que no puedan soportar el amperaje requerido se resaltarán en rojo, mientras que aquellos con una caída de voltaje entre el 3% y el 5% se mostrarán en amarillo; los calibres con una caída de voltaje menor al 3% se destacarán en verde.</p>

<p>Con nuestra aplicación, obtendrá resultados precisos y claros que le ayudarán a tomar decisiones informadas sobre el cableado de su sistema de bombeo.</p>
{% endblock %}